# ğŸ¢ API DevoluÃ§Ã£o Betha - Cornelio ProcÃ³pio

Sistema modular para geraÃ§Ã£o de JSONs de imÃ³veis compatÃ­veis com a API da Betha Cloud, extraindo dados do banco GEON.

## ğŸ“‹ Estrutura do Projeto

```
cornelio/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.py                          # Menu principal
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”œâ”€â”€ sql.py                       # Queries SQL originais
â”‚   â”‚   â””â”€â”€ token_betha.json            # ConfiguraÃ§Ã£o da API
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”‚   â””â”€â”€ conn.py                 # ConexÃ£o com banco
â”‚   â”‚   â”œâ”€â”€ transformers/
â”‚   â”‚   â”‚   â”œâ”€â”€ imovel_builder.py      # Construtor principal do JSON
â”‚   â”‚   â”‚   â”œâ”€â”€ sql_queries_simple.py  # Queries SQL organizadas
â”‚   â”‚   â”‚   â”œâ”€â”€ data_mappers.py        # Mapeadores de dados
â”‚   â”‚   â”‚   â”œâ”€â”€ bic_extractor.py       # Extrator de BICs
â”‚   â”‚   â”‚   â””â”€â”€ areas_extractor.py     # Extrator de Ã¡reas
â”‚   â”‚   â””â”€â”€ api/
â”‚   â”‚       â”œâ”€â”€ imovel/                 # APIs de imÃ³veis
â”‚   â”‚       â””â”€â”€ pessoa/                 # APIs de pessoas
â”‚   â””â”€â”€ cli/
â”‚       â””â”€â”€ console.py                  # Interface do usuÃ¡rio
â””â”€â”€ data/
    â””â”€â”€ json/
        â”œâ”€â”€ get_imovel/                 # Downloads da API
        â”œâ”€â”€ get_imovelcamposadicionais/ # Campos adicionais
        â””â”€â”€ post_imoveis/               # JSONs para devoluÃ§Ã£o âœ¨

```

## ğŸ¯ Funcionalidades Implementadas

### âœ… Dados ExtraÃ­dos do Banco GEON

1. **Dados BÃ¡sicos**
   - ID do imÃ³vel
   - InscriÃ§Ã£o imobiliÃ¡ria
   - MatrÃ­cula
   - Tipo (Urbano/Rural)
   - SituaÃ§Ã£o (Ativado/Inativo)
   - Setor, Quadra, Lote

2. **LocalizaÃ§Ã£o**
   - Latitude e Longitude (coordenadas geogrÃ¡ficas)
   - EndereÃ§o completo (quando disponÃ­vel)

3. **Ãreas** ğŸ†•
   - âœ… Ãrea do Lote
   - âœ… Ãrea de cada EdificaÃ§Ã£o (por sequÃªncia)
   - âœ… Ãrea Total ConstruÃ­da

4. **BICs (Boletim de InformaÃ§Ãµes Cadastrais)** ğŸ†•
   
   **BICs do Lote:**
   - Meio Fio
   - PavimentaÃ§Ã£o
   - OcupaÃ§Ã£o
   - UtilizaÃ§Ã£o
   - SituaÃ§Ã£o
   - Cerca/Muro

   **BICs da EdificaÃ§Ã£o:**
   - Tipo
   - Alinhamento
   - LocalizaÃ§Ã£o
   - PosiÃ§Ã£o
   - Estrutura
   - Cobertura
   - VedaÃ§Ã£o
   - Forro
   - Revestimento Externo
   - SanitÃ¡rios
   - Acabamento Interno
   - Piso
   - ConservaÃ§Ã£o
   - UtilizaÃ§Ã£o

## ğŸš€ Como Usar

### OpÃ§Ã£o 1: Via Menu Interativo

```bash
cd "cornelio"
python3 src/main.py
```

Escolha a opÃ§Ã£o **[ 4 ] Gerar JSON de IMÃ“VEL para devoluÃ§Ã£o**

### OpÃ§Ã£o 2: Via CÃ³digo Python

```python
from src.utils.transformers.imovel_builder import build_imovel_payload, write_imovel_payload

# Gerar JSON para um cadastro especÃ­fico
cadastro = 1
payload = build_imovel_payload(cadastro)

# Salvar em arquivo
arquivo = write_imovel_payload(cadastro, payload)
print(f"JSON salvo em: {arquivo}")
```

### OpÃ§Ã£o 3: Gerar MÃºltiplos JSONs

```python
from src.utils.transformers.imovel_builder import build_imovel_payload, write_imovel_payload

cadastros = [1, 47, 1000, 1001, 1002]

for cadastro in cadastros:
    try:
        payload = build_imovel_payload(cadastro)
        arquivo = write_imovel_payload(cadastro, payload)
        print(f"âœ“ Cadastro {cadastro}: {arquivo}")
    except Exception as e:
        print(f"âœ— Cadastro {cadastro}: Erro - {e}")
```

## ğŸ“„ Exemplo de JSON Gerado

```json
{
  "idImovel": 1,
  "inscricaoImobiliaria": "0101001",
  "tipoImovel": "URBANO",
  "situacao": "ATIVADO",
  "unidade": 0,
  "matricula": "0231-A",
  "setor": "01",
  "quadra": "01",
  "lote": "001",
  "latitude": 7436507.451099921,
  "longitude": 535993.3114857201,
  "camposAdicionais": [
    {
      "campoAdicional": {
        "titulo": "Ãrea do Lote",
        "tipo": "NUMERICO"
      },
      "vlCampo": 231.0
    },
    {
      "campoAdicional": {
        "titulo": "Ãrea edificaÃ§Ã£o seq 1",
        "tipo": "NUMERICO"
      },
      "vlCampo": 220.87
    },
    {
      "campoAdicional": {
        "titulo": "Ãrea Total ConstruÃ­da",
        "tipo": "NUMERICO"
      },
      "vlCampo": 220.87
    }
  ],
  "enderecoCorrespondencia": "IMOVEL",
  "usarEnderecoCondominio": "NAO"
}
```

## ğŸ”§ Arquitetura Clean Code

O projeto segue princÃ­pios de **Clean Code** e **SOLID**:

- **Modularidade**: Cada mÃ³dulo tem uma responsabilidade Ãºnica
- **SeparaÃ§Ã£o de Responsabilidades**: SQL, mapeamento e construÃ§Ã£o sÃ£o mÃ³dulos independentes
- **FÃ¡cil ManutenÃ§Ã£o**: CÃ³digo organizado e documentado
- **ExtensÃ­vel**: FÃ¡cil adicionar novos campos e funcionalidades

### MÃ³dulos Principais

1. **`imovel_builder.py`**: Orquestrador principal que monta o JSON
2. **`sql_queries_simple.py`**: Todas as queries SQL organizadas
3. **`data_mappers.py`**: ConversÃ£o de dados brutos para formato API
4. **`bic_extractor.py`**: ExtraÃ§Ã£o de BICs do banco
5. **`areas_extractor.py`**: ExtraÃ§Ã£o e cÃ¡lculo de Ã¡reas

## ğŸ“Š Status da ImplementaÃ§Ã£o

| Funcionalidade | Status | ObservaÃ§Ãµes |
|---------------|--------|-------------|
| Dados bÃ¡sicos | âœ… | Completo |
| Coordenadas | âœ… | Latitude/Longitude |
| Ãreas | âœ… | Lote e EdificaÃ§Ãµes |
| BICs Lote | âœ… | Estrutura pronta |
| BICs EdificaÃ§Ã£o | âœ… | Estrutura pronta |
| ProprietÃ¡rios | âš ï¸ | Precisa ajuste nas queries |
| Testadas | âš ï¸ | Precisa ajuste nas queries |
| Loteamento | âš ï¸ | Precisa ajuste nas queries |
| CondomÃ­nio | âš ï¸ | Precisa ajuste nas queries |

## ğŸ”„ PrÃ³ximos Passos

1. Ajustar queries de proprietÃ¡rios/responsÃ¡veis
2. Completar extraÃ§Ã£o de testadas
3. Adicionar dados de loteamento/condomÃ­nio
4. Implementar validaÃ§Ã£o dos JSONs antes do POST
5. Criar logs de processamento

## ğŸ’» Requisitos

- Python 3.8+
- PostgreSQL com banco GEON
- Bibliotecas: `psycopg2`, `requests`, `colorama`

## ğŸ“ Suporte

Para dÃºvidas ou sugestÃµes, consulte a documentaÃ§Ã£o da API Betha:
- https://arrecadacao.ajuda.betha.cloud/tributos/conteudostecnicos/migracao
- https://arrecadacao.ajuda.betha.cloud/tributos/conteudostecnicos/interacao/geoprocessamento